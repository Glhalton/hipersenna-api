generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ### TABELAS ###

model hsemployees {
  id                  Int                   @id @default(autoincrement())
  branch_id           Int
  winthor_id          Int                   @unique @default(0)
  name                String
  username            String                @unique
  password            String
  role_id             Int?                   
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  modified_at         DateTime              @default(now()) @updatedAt @db.Timestamptz(6)
  branch              hsbranches            @relation(fields: [branch_id], references: [id])
  role                hsroles?               @relation(fields: [role_id], references: [id])
  sessions            hssessions[]
  hsusers_permissions hsusers_permissions[]
  hsvalidities        hsvalidities[]
  analystRequests     hsvalidity_requests[] @relation("AnalystRelation")
  confereeRequests    hsvalidity_requests[] @relation("ConfereeRelation")
  hsconsumer_products hsconsumer_products[]

  @@map("hsemployees")
}

model hsroles {
  id                  Int                   @id @default(autoincrement())
  name                String                @unique @db.VarChar(50)
  description         String                @db.VarChar(150)
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  modified_at         DateTime              @default(now()) @updatedAt @db.Timestamptz(6)
  hsroles_permissions hsroles_permissions[]
  hsemployees         hsemployees[]
}

model hspermissions {
  id                  Int                   @id @default(autoincrement())
  name                String                @unique @db.VarChar(50)
  description         String                @db.VarChar(150)
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  modified_at         DateTime              @default(now()) @updatedAt @db.Timestamptz(6)
  hsroles_permissions hsroles_permissions[]
  hsusers_permissions hsusers_permissions[]
}

model hsroles_permissions {
  role_id       Int
  permission_id Int
  hspermissions hspermissions @relation(fields: [permission_id], references: [id])
  hsroles       hsroles       @relation(fields: [role_id], references: [id])

  @@id([role_id, permission_id])
}

model hsusers_permissions {
  user_id       Int
  permission_id Int
  hspermissions hspermissions @relation(fields: [permission_id], references: [id])
  hsemployees   hsemployees   @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@id([user_id, permission_id])
}

model hsbranches {
  id                  Int                   @id @default(autoincrement())
  description         String                @db.VarChar(150)
  hsemployees         hsemployees[]
  hsvalidities        hsvalidities[]
  hsvalidity_requests hsvalidity_requests[]
  hsconsumerProducts  hsconsumer_products[]
  consumptionNotes    hsconsumption_note[]
}

model hsvalidities {
  id                  Int                   @id @default(autoincrement())
  branch_id           Int
  employee_id         Int
  status              HsValiditiesStatus    @default(PENDENTE)
  request_id          Int?
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  modified_at         DateTime              @default(now()) @updatedAt @db.Timestamptz(6)
  hsbranches          hsbranches            @relation(fields: [branch_id], references: [id])
  hsemployees         hsemployees           @relation(fields: [employee_id], references: [id])
  hsvalidity_requests hsvalidity_requests?  @relation(fields: [request_id], references: [id])
  hsvalidity_products hsvalidity_products[]
}

model hsvalidity_products {
  id                    Int                   @id @default(autoincrement())
  validity_id           Int
  product_code          Int
  quantity              Int
  validity_date         DateTime              @db.Date
  treat_id              Int                   @default(1)
  auxiliary_code        String                @db.VarChar(150)
  hsvalidity_treatments hsvalidity_treatments @relation(fields: [treat_id], references: [id])
  hsvalidities          hsvalidities          @relation(fields: [validity_id], references: [id])
}

model hsvalidity_requests {
  id                          Int                           @id @default(autoincrement())
  branch_id                   Int
  analyst_id                  Int
  conferee_id                 Int
  status                      HsValidityRequestsStatus      @default(PENDENTE)
  created_at                  DateTime                      @default(now()) @db.Timestamptz(6)
  modified_at                 DateTime                      @default(now()) @updatedAt @db.Timestamptz(6)
  hsvalidities                hsvalidities[]
  hsvalidity_request_products hsvalidity_request_products[]
  analyst                     hsemployees                   @relation("AnalystRelation", fields: [analyst_id], references: [id])
  hsbranches                  hsbranches                    @relation(fields: [branch_id], references: [id])
  conferee                    hsemployees                   @relation("ConfereeRelation", fields: [conferee_id], references: [id])
}

model hsvalidity_request_products {
  id                  Int                             @id @default(autoincrement())
  request_id          Int
  status              HsValidityRequestProductsStatus @default(NAO_VISTORIADO)
  product_code        Int
  validity_date       DateTime                        @db.Date
  auxiliary_code      String                          @db.VarChar(150)
  hsvalidity_requests hsvalidity_requests             @relation(fields: [request_id], references: [id])
}

model hsvalidity_treatments {
  id                  Int                   @id @default(autoincrement())
  description         String                @db.VarChar(150)
  hsvalidity_products hsvalidity_products[]
}

model hssessions {
  id         String      @id @default(uuid()) @db.Uuid
  user_id    Int
  token      String      @unique
  created_at DateTime    @default(now()) @db.Timestamptz(6)
  expires_at DateTime?   @db.Timestamptz(6)
  user       hsemployees @relation(fields: [user_id], references: [id], onDelete: Cascade)

  @@map("hssessions")
}

/**
 * Problema do preço: o preço dos produtos tambem devem ser passados para a tabela?
 * Preço muda com o tempo, devo pegar os preços quando adiiconar o produto ou quando criar
 * a nota de consumo?
 */
model hsconsumer_products {
  id                 Int                 @id @default(autoincrement())
  consumption_id     Int?
  employee_id        Int
  branch_id          Int
  product_code       Int
  auxiliary_code     String
  quantity           Int
  unit_price         Decimal
  total_price        Decimal
  group_id           Int
  created_at         DateTime            @default(now()) @db.Timestamptz(6)
  modified_at        DateTime            @default(now()) @updatedAt @db.Timestamptz(6)
  hsemployees        hsemployees         @relation(fields: [employee_id], references: [id])
  hsconsumer_groups  hsconsumer_groups   @relation(fields: [group_id], references: [id])
  branch             hsbranches          @relation(fields: [branch_id], references: [id])
  hsconsumption_note hsconsumption_note? @relation(fields: [consumption_id], references: [id])
}

model hsconsumption_note {
  id                 Int                   @id @default(autoincrement())
  employee_id        Int
  branch_id          Int
  group_id           Int
  total_price        Decimal
  created_at         DateTime              @default(now()) @db.Timestamptz(6)
  modified_at        DateTime              @default(now()) @updatedAt @db.Timestamptz(6)
  hsconsumer_groups  hsconsumer_groups     @relation(fields: [group_id], references: [id])
  branch             hsbranches            @relation(fields: [branch_id], references: [id])
  hsconsumerProducts hsconsumer_products[]
}

model hsconsumer_groups {
  id                  Int                   @id @default(autoincrement())
  description         String
  created_at          DateTime              @default(now()) @db.Timestamptz(6)
  modified_at         DateTime              @default(now()) @updatedAt @db.Timestamptz(6)
  hsconsumer_products hsconsumer_products[]
  consumptionNotes    hsconsumption_note[]
}

model hsraffles {
  id               Int              @id @default(autoincrement())
  client_id        Int
  status           HsRafflesStatus  @default(ATIVO)
  nfc_key          String
  raffle_number    String?
  branch_id        Int
  created_at       DateTime         @default(now()) @db.Timestamptz(6)
  modified_at      DateTime         @default(now()) @updatedAt @db.Timestamptz(6)
  hsraffle_clients hsraffle_clients @relation(fields: [client_id], references: [id])
}

model hsraffle_clients {
  id          Int         @id @default(autoincrement())
  cpf         String
  name        String
  telephone   String
  created_at  DateTime    @default(now()) @db.Timestamptz(6)
  modified_at DateTime    @default(now()) @updatedAt @db.Timestamptz(6)
  hsraffles   hsraffles[]
}

// ### ENUMS ###

enum HsValiditiesStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDO
}

enum HsValidityRequestProductsStatus {
  NAO_ENCONTRADO
  NAO_VISTORIADO
  VISTORIADO
}

enum HsValidityRequestsStatus {
  PENDENTE
  EM_ANDAMENTO
  CONCLUIDO
  EXPIRADO
}

enum HsRafflesStatus {
  ATIVO
  INATIVO
  SORTEADO
  CANCELADO
}
